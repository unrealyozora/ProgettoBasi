\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage[T1]{fontenc}
\usepackage{lmodern} % O usa 'times' per un font più simile al PDF
\usepackage{geometry}
\geometry{margin=3cm}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{titlesec}
\usepackage{caption}
\usepackage{booktabs}
\usepackage{float}
\usepackage{hyperref}
\usepackage{array}
\graphicspath{ {./images/} }
\pagestyle{plain}
\onehalfspacing % Interlinea 1.5
\setlength{\parskip}{0.5em}

% ------------------ FRONTESPIZIO ------------------
\begin{document}
\begin{titlepage}
    \centering
    {\scshape\LARGE Università degli Studi di Padova \par}
    \vspace{1cm}
    {\scshape\Large Corso di Laurea in Informatica \par}
    \vspace{3cm}
    {\Huge\bfseries Basi di Dati per un Sistema di gestione di Serie TV in Streaming \par}
    \vspace{2cm}
    {\Large Gruppo: Ceron Tommaso, Parolin Dennis\par}
    \vfill
    {\large Anno Accademico 2024/2025\par}
\end{titlepage}

------------------ INDICE (se necessario) ------------------
\tableofcontents
\newpage

% ------------------ CONTENUTO ------------------

\section{Abstract}
Questo progetto sviluppa una base di dati per gestire delle serie tv, composte da stagioni ed episodi, e dai loro attori e registi. Inoltre, questa base di dati permette di gestire degli utenti e gli episodi che guardano, ai quali possono dare un voto.\newline L'obbiettivo principale è quello di gestire la struttura delle serie tv, gestire le relazioni di quest’ ultime con il cast e il regista che vi partecipa e infine registrare ciò che un utente guarda.\newline
La base di dati distingue le persone in utenti, registi e attori, ognuno con degli attributi e relazioni distinte.\newline
Una serie si compone di almeno una stagione, che a sua volta è composta da almeno un episodio. Opzionalmente una Serie TV può anche contenere una Opening (ovvero una sigla iniziale).\newline
Infine, il sistema tiene traccia delle piattaforme di streaming che mettono a disposizione una determinata serie tv, e degli utenti che sottoscrivono un abbonamento con uno o più di queste piattaforme. \newline

\section{Analisi dei Requisiti}
In questa sezione riassumiamo i requisiti che caratterizzano la base di dati.\newline\newline
\textbf{Serie TV.} Una serie TV è identificata da un titolo e un anno e contiene questi attributi:
\begin{itemize}
  \item Titolo
  \item Anno di Inizio
  \item Descrizione
  \item Genere
\end{itemize}
Una Serie TV è composta da una o più stagioni, e da zero o una Opening (sigla iniziale) \newline\newline\newline\newline
\textbf{Stagioni.} Una stagione è identificata da un identificatore univoco e contiene questi attributi:
\begin{itemize}
    \item Identificatore
    \item Numero
    \item Anno
\end{itemize}
Una stagione è composta da uno o più episodi\newline\newline
\textbf{Episodio.} Un episodio è identificato da un identificatore univoco e contiene questi attributi:
\begin{itemize}
    \item Identificatore
    \item Numero
    \item Durata (in minuti)
    \item Titolo
    \item Numero di utenti (che hanno guardato l' episodio)
\end{itemize}
\textbf{Opening.} Una opening è identificata da un titolo, e contiene questi attributi:
\begin{itemize}
    \item Titolo
    \item Compositore
    \item Durata
\end{itemize}
\textbf{Persona.} Una persona generica è identificata da un identificatore univoco e contiene i seguenti attributi: 
\begin{itemize}
    \item Identificatore
    \item Nome
    \item Data di nascita
\end{itemize}
Una persona si suddivide in \textbf{Utente}, \textbf{Nome} e \textbf{Registi}\newpage
\textbf{Utenti.} Un utente, oltre agli attributi di \textit{Persona} contiene:
\begin{itemize}
    \item Username
    \item Email
\end{itemize}
\textbf{Attore.} Un attore, oltre agli attributi di \textit{Persona}, contiene:
\begin{itemize}
    \item Nazionalita'
    \item Il numero di film in cui ha partecipato
\end{itemize}
\textbf{Regista.} Un regista, oltre agli attributi di \textit{Persona}, contiene:
\begin{itemize}
    \item Nazionalita
    \item Il genere di film creati
\end{itemize}
\textbf{Piattaforma streaming.} Una piattaforma streaming e' identificata dal suo nome e contiene i seguenti attributi:
\begin{itemize}
    \item Nome 
    \item Costo mensile
\end{itemize}
\section{Progettazione concettuale}
\subsection{Lista entità}
Il database si compone delle seguenti entità:
\begin{itemize}
    \item \textbf{SerieTV:} Rappresenta una Serie Tv univoca, con una o più stagioni.
    \begin{itemize}
        \item \underline{Titolo}: string
        \item \underline{AnnoInizio} (ovvero l'anno della prima stagione): int
        \item Genere: string
        \item Descrizione: string
    \end{itemize}
    \item \textbf{Stagione:} Rappresenta una stagione di una specifica Serie Tv
    \begin{itemize}
        \item \underline{Numero\_ stagione}: int
        \item Anno: int
    \end{itemize}
    \item \textbf{Episodio:} Rappresenta un singolo episodio di una specifica stagione
    \begin{itemize}
        \item \underline{Numero\_ episodio}: int
        \item Durata (in minuti): int
        \item Titolo: string
        \item Numero\_utenti (che hanno guardato l'episodio): int
    \end{itemize}
    \item \textbf{Opening:} Rappresenta la sigla iniziale di una SerieTv, se presente.
    \begin{itemize}
        \item \underline{Titolo}: string
        \item Durata: int
        \item Compositore: string
    \end{itemize}
    \item \textbf{Persona:} Rappresenta una persona generica.
    \begin{itemize}
        \item \underline{Identificatore}: int
        \item Nome: string
        \item Data\_ nascita: date
    \end{itemize}
    \item \textbf{Utente:} Rappresenta una specializzazione di Persona, rappresenta un abbonato a una o più piattaforme streaming
    \begin{itemize}
        \item Username: string
        \item Email: string
    \end{itemize}
    \item \textbf{Attore:} Rappresenta una specializzazione di Persona, partecipa a una o più serie TV.
    \begin{itemize}
        \item Nazionalita': string
        \item Numero\_serie (in cui ha partecipato): int
    \end{itemize}
    \item \textbf{Regista:} Rappresenta una specializzazione di Persona, ha diretto una o più serie TV.
    \begin{itemize}
        \item Nazionalita: string
        \item Genere\_serie: string
    \end{itemize}
    \item \textbf{Piattaforma streaming:} Rappresenta una piattaforma che contiene una o più serie Tv, e a cui gli utenti possono abbonarsi con vari tipi di abbonamento.
    \begin{itemize}
        \item \underline{Nome}: string
        \item Costo\_mensile: float
    \end{itemize}
\end{itemize}
\subsection{Lista relazioni}
\begin{itemize}
    \item Serie TV-> (1, N) ->ComposizioneStag<-(1,1) <-Stagione 
    \begin{itemize}
        \item Una Serie Tv è composta da una o più stagioni
        \item Una stagione compone una sola Serie Tv 
    \end{itemize}
    \item Stagione-> (1, N) ->ComposizioneEP<-(1,1) <-Episodio
    \begin{itemize}
        \item Una stagione è composta da uno o più episodi
        \item Un episodio compone una sola stagione
    \end{itemize}
    \item Serie TV-> (1,1) ->Contenimento<-(1, N) <-Piattaforma-Streaming
    \begin{itemize}
        \item Una Serie Tv è contenuta (può essere vista) in una sola piattaforma streaming
        \item Una piattaforma streaming può contenere una o più serie tv 
    \end{itemize}
    \item Piattaforma-Streaming (1, N) ->Sottoscrizione<-(1, N) <-Utente
    \begin{itemize}
        \item Ad una piattaforma streaming si sottoscrivono uno o più utenti
        \item Un utente può sottoscriversi a una o più piattaforme streaming (minimo una per essere considerato utente)
        \item Questa relazione contiene i seguenti attributi:
        \begin{itemize}
            \item Data\_inizio: date
            \item Data\_fine: date
            \item Tpo\_abbonamento: string
        \end{itemize}
    \end{itemize}
    \item Utente-> (0, N) ->Visiona<-(0, N) <-Episodio
    \item \begin{itemize}
        \item Un utente può vedere 0 o più episodi di stagioni differenti
        \item Un episodio generico può essere visto da nessuno o da più utenti
        \item Questa relazione contiene i seguenti attributi:
        \begin{itemize}
            \item Data: date
            \item Voto: int
        \end{itemize}
        Il voto e' opzionale.
    \end{itemize}
    \begin{itemize}
        \item Serie TV-> (1, N) ->RecitaIn<-(1, N) <-Attore
        \begin{itemize}
            \item In una serie tv recitano uno o più attori
            \item Un attore può recitare in una o più sere tv
            \item Questa relazione contiene i seguenti attributi:
            \begin{itemize}
                \item Ruolo: string
            \end{itemize}
        \end{itemize}
    \end{itemize}
    \item Serie TV-> (1,1) ->Direzione<-(1, N)<-Regista 
    \begin{itemize}
        \item Una serie tv è diretta da un solo regista 
        \item Un regista può dirigere una o più serie 
    \end{itemize}
    \item Serie Tv-> (0,1) ->ContenimentoOpening<-(1,1)<-Opening
    \begin{itemize}
        \item Una serie tv contiene zero o una opening
        \item Una opening appartiene a una sola Serie Tv 
    \end{itemize} 
\end{itemize}
\subsection{Lista generalizzazioni}
\textbf{Persona} è una generalizzazione totale di \textbf{UTENTE}, \textbf{ATTORE} e \textbf{REGISTA} 

\subsection{Schema E-R}
\textbf{In figura \ref{fig:no-ristrutt}} è riportato il diagramma E-R che riassume i requisiti discussi in precedenza.
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.4]{schema-no-ristrutt.jpg}
    \caption{a nice plot}
    \label{fig:no-ristrutt}
\end{figure}
\section{Progettazione Logica}
In questa sezione illustriamo la traduzione dello schema concettuale in schema logico, per rappresentare i dati nel modo piu' efficace possibile. 
Andiamo quindi ad analizzare le ridondanze, per comprendere se sia preferibile eliminarle o mantenerle. 
Procediamo poi con l'eliminazione delle generalizzazioni e infine mostriamo lo schema ristrutturato.
\subsection{Analisi delle ridondanze}
\subsubsection{Ridondanza "NumeroSerieTv"}
Possiamo notare che attributo “Numero Serie Tv” del sottoinsieme “Attore” entità “Persona” può essere calcolato dalla relazione RecitaIn, poiché è il conteggio di tutte le Serie Tv per quel determinato attore.
Questo attributo viene modificato (almeno una volta) ogni volta che viene inserita una nuova SerieTv (stimiamo circa 5 nuovi inserimenti al giorno)
e viene visualizzato ogni volta un utente vuole sapere in quanti film ha recitato un attore (stimiamo 25 al giorno).
Il tutto si riassume nelle seguenti operazioni:
\begin{itemize}
    \item \textbf{Operazione 1 (5 al giorno)}: inserimento di una nuova tupla in RecitaIn
    \item \textbf{Operazione 2 (25 al giorno)}: Visualizzare in quanti film ha recitato un attore.
\end{itemize}

Assumiamo i seguenti dati:
\begin{center}
\begin{tabular}{|c c c|} 
 \hline
 Concetto & Costrutto & Volume \\ [0.5ex] 
 \hline\hline
 Attore & Entità  & 1000\\ 
 \hline
 RecitaIn & Relazione & 2000\\[1ex] 
 \hline
\end{tabular}
\end{center}
\textbf{Con Ridondanza}
\begin{itemize}
    \item Operazione 1
    \begin{center}
    \begin{tabular}{|c|c|c|c|}
    \hline
    \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
    \hline
    Serie TV & E & 1 & S\rlap{\hspace{2.5em}$\times\,5$} \\
    RecitaIn & R & 1 & S\rlap{\hspace{2.5em}$\times\,5$} \\
    Attore & E & 1 & L\rlap{\hspace{2.5em}$\times\,5$} \\
    Attore & E & 1 & S\rlap{\hspace{2.5em}$\times\,5$} \\
    \hline
    \end{tabular}
    \item Operazione 2
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Attore & E & 1 & L\rlap{\hspace{2.5em}$\times\,25$} \\
        \hline
        \end{tabular}
    \end{center}
    \end{center}
    Assumiamo costo doppio per le operazioni in scrittura, il costo totale ottenuto è:
    $((5\times 3)\times 2) + 5 + 25=60$
\end{itemize}
\textbf{Senza Ridondanza}
\begin{itemize}
    \item Operazione 1
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Serie Tv & E & 1 & S\rlap{\hspace{2.5em}$\times\,5$} \\
        \hline
        RecitaIn & R & 1 & S\rlap{\hspace{2.5em}$\times\,5$} \\
        \hline
        \end{tabular}
    \end{center}
    \item Operazione 2\newline
    Stimiamo circa 2.000 performance attoriali
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Attore & E & 1 & L\rlap{\hspace{2.5em}$\times\,25$} \\
        \hline
        RecitaIn & R & 2.000 & L\rlap{\hspace{2.5em}$\times\,25$} \\
        \hline
        \end{tabular}
    \end{center}
\end{itemize}
Assumiamo costo doppio per le operazioni in scrittura, il costo totale ottenuto è:
    $((5\times 2)\times 2)+25+(2000\times 25)\times 2=100.045$\newline
    Questo calcolo permette di stabilire che mantenere la ridondanza è preferibile,
    in modo da ottimizzare gli accessi.
\subsubsection{Ridondanza "NumeroUtenti"}
L' attributo “Numero utenti” dell'entità Episodio (relativa al numero di utenti che hanno guardato l'episodio) può essere calcolato a partire dalla relazione “Visione”, 
in quanto è il conteggio di tutti gli utenti che hanno guardato quell'episodio.
L'attributo viene modificato ogni volta che un utente guarda un episodio e viene visualizzato 50 volte al giorno per controllare l'andamento della piattaforma.
Il tutto si riassume nelle seguenti operazioni:
\begin{itemize}
    \item \textbf{Operazione 1 (10.000 al giorno)}: inserimento di una nuova tupla in Visiona
    \item \textbf{Operazione 2 (50 al giorno)}: Visualizzare il numero di utenti che hanno guardato un episodio.
\end{itemize}
Assumiamo i seguenti dati:
\begin{center}
\begin{tabular}{|c c c|} 
 \hline
 Concetto & Costrutto & Volume \\ [0.5ex] 
 \hline\hline
 Episodio & Entità  & 10.000\\ 
 \hline
 Visiona & Relazione & 1.000.000\\[1ex] 
 \hline
\end{tabular}
\end{center}
\textbf{Con ridondanza}
\begin{itemize}
    \item Operazione 1
    \begin{center}
    \begin{tabular}{|c|c|c|c|}
    \hline
    \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
    \hline
    Visione & R & 1 & S\rlap{\hspace{2.5em}$\times\,10.000$} \\
    Episodio & E & 1 & L\rlap{\hspace{2.5em}$\times\,10.000$} \\
    Episodio & E & 1 & S\rlap{\hspace{2.5em}$\times\,10.000$} \\
    \hline
    \end{tabular}
    \end{center}
    \item Operazione 2
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Utenti & E & 1 & L\rlap{\hspace{2.5em}$\times\,25$} \\
        \hline
        \end{tabular}
    \end{center}
\end{itemize}
\textbf{Senza ridondanza}
\begin{itemize}
    \item Operazione 1
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Visione & R & 1 & S\rlap{\hspace{2.5em}$\times\,10.000$} \\
        \hline
        \end{tabular}
    \end{center}
    Assumiamo costo doppio per le operazioni in scrittura, il costo totale ottenuto è:
    $(10.000\times2)\times2+10.000+50=50.050$
    \item Operazione 2
    \begin{center}
        \begin{tabular}{|c|c|c|c|}
        \hline
        \textbf{Conecetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        \hline
        Episodio & E & 1 & L\rlap{\hspace{2.5em}$\times\,200$} \\
        \hline
        RecitaIn & R & 1.000.000 & L\rlap{\hspace{2.5em}$\times\,200$} \\
        \hline
        \end{tabular}
    \end{center}
    Assumiamo costo doppio per le operazioni in scrittura, il costo totale ottenuto è:
    $(10.000\times2)+200+(200\times2)=20.600$
\end{itemize}
    In questo caso invece è preferibile eliminare la ridondanza.
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.4]{schema-ristrutt.jpg}
    \caption{Schema E-R ristrutturato}
    \label{fig:ristrutt}
\end{figure}
% Aggiungi altre sezioni qui...
\subsection{Eliminazione delle generalizzazioni}
\textbf {Persona} è una generalizzazione totale di \textbf{UTENTE}, \textbf{ATTORE} e \textbf{REGISTA}, presenta
tre attributi \textit{Nome} , \textit{Data di nascita} e \textit{Identificatore}, ma non è legata a nessuna relazione.
Si nota quindi come questa generalizzazione possa essere eliminata. È preferibile infatti
accorpare i sue attributi nelle entità figlie. In questo modo si riduce il numero di attributi NULL rispetto all'operazione inversa,
ovvero accorpare gli attributi delle entità figlie in una sola entità padre.\newline
\textbf{In figura \ref{fig:ristrutt}} è riportato il diagramma E-R ristrutturato, in cui sono state effettuate le modifiche discusse precedentemente.

\subsection{Schema relazionale}
In seguito è riportato lo schema logico costruito a partire dallo schema E-R ristrutturato.
L'asterisco indica gli attrributi che possono essere NULL.
\begin{itemize}
    \item \textbf{Serie}(\underline{Titolo, AnnoInizio}, Genere, Descrizione, Regista, PiattaformaStreaming, Opening)
    \begin{itemize}
        \item Serie.Regista=Regista.ID
        \item Serie.PiattaformaStreaming=PiattaformaStreaming.Nome
    \end{itemize}
    \item \textbf{Stagione}(\underline{TitoloSerie, AnnoSerie, NumeroStagione}, Anno)
    \begin{itemize}
        \item Stagione.TitoloSerie=Serie.Titolo
        \item Stagione.AnnoSerie=Serie.AnnoInizio
    \end{itemize}
    \item \textbf{Episodio}(\underline{TitoloSerie, AnnoSerie, NumeroStagione, NumeroEpisodio}, Durata, Titolo, NumeroUtenti)
    \begin{itemize}
        \item Episodio.TitoloSerie=Stagione.TitoloSerie
        \item Episodio.AnnoSerie=Stagione.AnnoSerie
        \item Episodio.NumeroStagione=Stagione.NumeroStagione
    \end{itemize}
    \item \textbf{Opening}(\underline{TitoloSerie, AnnoSerie}, Titolo, Compositore, Durata)
    \item \textbf{Visualizzazione}(\underline{Username, TitoloSerie, AnnoSerie, NumeroStagione, NumeroEpisodio}, Data, Voto*) 
    \begin{itemize}
        \item Visualizzazione.Username=Utente.Username
        \item Visualizzazione.TitoloSerie=Episodio.TitoloSerie
        \item Visualizzazione.AnnoSerie=Episodio.AnnoSerie
        \item Visualizzazione.NumeroStagione=Episodio.NumeroStagione
        \item Visualizzazione.NumeroEpisodio=Episodio.Numero
    \end{itemize}
    \item \textbf{Utente}(\underline{Username}, Nome, DataNascita, Email)
    \item \textbf{Attore}(\underline{ID}, Nome, DataNascita, Nazionalita, NumeroSerie)
    \item \textbf{Regista}(\underline{ID}, Nome, DataNascita, Nazionalita, GenereSerie)
    \item \textbf{PiattaformaStreaming}(\underline{Nome}, CostoMensile)
    \item \textbf{Sottoscrizione}(\underline{Username, Piattaforma}, DataInizio, DataFine*, TipoAbbonamento)
    \begin{itemize}
        \item Sottoscrizione.Username=Utente.Username
        \item Sottoscrizione.Piattaforma=PiattaformaStreaming.Nome
    \end{itemize}
    \item \textbf{Performance}(\underline{IDAttore, TitoloSerie, AnnoSerie}, Ruolo, Compenso)
    \begin{itemize}
        \item Performance.Attore=Attore.ID
        \item Perfomance.TitoloSerie=Serie.Titolo
        \item Performance.AnnoSerie=Serie.AnnoInizio
    \end{itemize}
\end{itemize}


\section{Implementazione in PostgreSQL e Definizione delle Query}

\subsection*{Definizione delle Query}

Di seguito vengono presentate e descritte le query con i relativi output generati e 
viene motivato l’utilizzo dell’indice proposto.

\vspace{1cm}

\subsubsection*{Query 1}
\textbf{Obiettivo:} Trovare tutti i titoli delle serie TV disponibili su una piattaforma specifica, ad esempio \textit{Netflix}.

\vspace{0.5cm}
\begin{center}
\includegraphics[width=0.9\textwidth]{Query1.jpg}
\end{center}

\vspace{1cm}

\subsubsection*{Query }
\textbf{Obiettivo:} Calcolare la media dei voti per ogni episodio della serie \textit{Dark}.

\vspace{0.5cm}
\begin{center}
\includegraphics[width=0.9\textwidth]{Query2.jpg}
\end{center}

\vspace{1cm}

\subsubsection*{Query 3}
\textbf{Obiettivo:} Elencare gli utenti che hanno guardato almeno 5 episodi in totale.

\vspace{0.5cm}
\begin{center}
\includegraphics[width=0.9\textwidth]{Query3.jpg}
\end{center}

\vspace{1cm}

\subsubsection*{Query 4}
\textbf{Obiettivo:} Trovare gli attori che hanno recitato in almeno una serie vista dall’utente \texttt{mario\_rossi}.

\vspace{0.5cm}
\begin{center}
\includegraphics[width=0.9\textwidth]{Query4.jpg}
\end{center}

\vspace{1cm}

\subsubsection*{Query 5}
\textbf{Obiettivo:} Trovare le prime 3 serie TV (per numero totale di visualizzazioni) dirette da registi italiani e disponibili su piattaforme con costo mensile superiore a 10 euro.

\vspace{0.5cm}
\begin{center}
\includegraphics[width=0.9\textwidth]{Query5.jpg}
\end{center}

\vspace{1cm}

\end{document}
